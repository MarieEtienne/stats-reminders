---
title: "EDO prÃ©dation"
format: html
editor: visual
---

```{r}
## Packages
library(ggplot2)
library(dplyr)
library(tidyr)
```

```{r}
##Trajectory simulation function using the Lotka-Volterra equation.
prey_equation <- function(N,P,r1,b1,K){
  return(r1*N*(1-(N/K))-b1*N*P)
}

predator_equation <- function(N,P,r2,b2){
  return(-r2*P+b2*N*P)
}

## N_0    : prey population at time 0 
## P_0    : predator population at time 0
## t_end  : final time of the simulation
## step   : time step
## r1     : intrinsic reproduction rate of prey
## b1     : mortality rate of prey due to predators
## r2     : reproduction rate of predators depending on prey 
## b2     : intrinsic mortality rate of predators
## K      : carrying capacity of prey
simul_traj <- function(N_0,P_0,t_end,pas,r1,b1,r2,b2,K){
  list_N <- c(N_0)
  dN <- N_0
  list_P <- c(P_0)
  dP <- P_0
  list_t <- c(0)
  t <- 0
  while (t<t_end){
    t<- t+pas
    list_t <- c(list_t,t)
    dN <- prey_equation(dN,dP,r1,b1,K)*pas
    if (dN<0){dN <- 0}
    dP <- predator_equation(dN,dP,r2,b2)*pas
    if (dP<0){dP <- 0}
    list_N <- c(list_N,dN)
    list_P <- c(list_P,dP)
  }
  
  ##data_wrangling
  data <- data.frame(time=list_t,prey=list_N,predator=list_P)
  data <- gather(data,key="specie",value="number",prey:predator)
  
  ##plot
  plot <- ggplot(data,aes(x=time,y=number,color=specie,group=specie)) +
    geom_line()
  plot
}
```

**INTRODUCTION** :

When having a dynamic system modeled by an ODE, we usually can't find a mathematical solution. Thus, we have 2 options : a numerical approach and a qualitative one. Here, we will focus on the latter, that is to say qualitatively predict the evolution (in terms of behavior) of N(t) (the number of the population at time t), in particular asymptotically.

Looking at lynx and hare pelts from the Hudson's Bay Company's (fur-collecting) trappers' hunts over a 90-year period, we see that the number of hare and lynx pelts is correlated. If we assume that the number of pelts collected is proportional to the total population, then we arrive at the conclusion that the hare and lynx population is correlated with a phase shift of a few years for the lynx (Elton & Nicholson).

What is the intuition behind this? Lynxes need hares to survive, and so the lynx population can only grow if the hare population grows. There's a time lag: when the lynx population is low, the hare population begins to grow. The lynxes then begin to have food again, and will then grow again and begin to massacre a large part of the hare population, only to run out of food. Then the cycle begins again.

```{r}
##An exemple of a prey-predator dynamic
simul_traj(N_0= 50,
           P_0= 5,
           t_end= 100,
           pas= 1,
           r1= 1.5,
           b1= 0.05,
           r2= 0.5,
           b2= 0.05,
           K= 500)
```

**Logistic Prey-Predator model (in a limited environment)** :

$$
\begin{cases} 
\frac{dN}{dt}=r_1N(1-\frac{N}{K})-b_1NP \\
\frac{dP}{dt}=-r_2P+b_2NP
\end{cases}
$$

The parameters are the following ones (they are all positive :) ) :

| Parameters | Meaning                             |
|------------|-------------------------------------|
| $r_{1}$    | growth rate of preys' population    |
| $r_{2}$    | death rate of predators' population |
| $b_{1}$    | predation efficiency                |
| $b_{2}$    | predation yield                     |
| ${K}$      | biotic capacity                     |

In such conditions, we expect the populations dynamics to evolve in different ways according to parameters value and initials conditions (the size of both population). We can relatively easily assume that a big predator's population paired with a high predation efficiency would lead prey's population to go extinct and, shortly after, predator's population is expected to follow the same dynamic. The question we may now ask ourselves is the following : how would the system evolve according to parameters and initials conditions variation? This is where qualitative analysis steps in. But first let's do a little bit of math.

**Equilibrium points and isoclines**

Let's start with a bit of vocabulary, in qualitative analysis we call equilibrium points all value of N for which the derivative is 0. Mathematicaly it's expressed as following : $$
\frac{dN}{dt}=0\;\Longleftrightarrow\;f(N^{*})=0 \\
\text{with}\;\ \frac{dN}{dt}=f(N)
$$ For equation system such as Lokta-Voltera it would be as following : $$
\begin{cases} \frac{dN_{1}}{dt}=0 \\ \frac{dN_{2}}{dt}=0 \end{cases} \;\Longleftrightarrow\; \begin{cases} f_{1}(N1^{*},N2^{*})=0 \\ f_{2}(N1^{*},N2^{*})=0 \end{cases}\\
\text{with}\;\ \begin{cases} \frac{dN_{1}}{dt}=f_{1}(N1,N2) \\ \frac{dN_{2}}{dt}=f_{2}(N1,N2) \end{cases}
$$ Those equilibrium points carry the information about the population sizes at which the system does not change. They can be either stable (LAS) unstable (repeller) and in the case the system has more than one differential equation, saddle points may appear. Around LAS points, system will go towards the equilibrium, around repeller points, system will tend to move away from equilibrium. As for saddle points, depending on the area the system will go toward or away the equilibrium points.

In contrast to equilibrium points, where all derivative must be equal to zero, isoclines correspond to lines for which an equation of the system is individually equal to zero. Mathematicaly it's expressed as following :

$$
\text{Isoclines $N_{1}$ :} \\
\frac{dN_{1}}{dt}=0 \;\Longleftrightarrow\; f_{1}(N1,N2)=0 \\
\text{Isoclines $N_{2}$ :}\\
\frac{dN_{2}}{dt}=0\;\Longleftrightarrow\; f_{2}(N1,N2)=0 \\
\text{With}\;\begin{cases} \frac{dN_{1}}{dt}=f_{1}(N1,N2) \\ \frac{dN_{2}}{dt}=f_{2}(N1,N2) \end{cases}
$$

Plotting those isoclines on a phase plane allows us to identify some areas where the system may evolve in different ways. We can then examine the behavior of each population in the previously defined area , allowing to characterize the system overall behavior.

All of that is analytically calculable for some systems of differential equation system (including Lotka-Volterra logistic), but lazy as we are, we will focus on numerically approximate those solutions.

**Numerical approximation of equilibrium points and phase plane**

```{r}
Proiepred<- function(t, y, parameters) {
  N <- y[1]
  P <- y[2]
  r1 <- parameters[1]
  r2 <- parameters[2]
  b1 <- parameters[3]
  b2 <- parameters[4]
  dPop <- numeric(2)
  dPop[1] <- r1*N - b1*N*P
  dPop[2] <- - r2*P + b2*N*P
  list(dPop)
}
```

***Bonus :*** We lied !! In the end, for those who are interested, we are going to describe the analytic approach.

To do so, we will introduce the **Jacobian Matrix** (Fun Fact : it was named after Carl Gustav Jacobi, an important 19th century mathematician who added huge contributions to the field of linear algebra).

This matrix is composed of the first-order partial derivatives of a multivariable function. The formula for the Jacobian Matrix is the following :

$$
\begin{equation}
Jac(N_1, N_2) =
\begin{pmatrix}
\frac{\partial f_1}{\partial N_1} & \frac{\partial f_1}{\partial N_2} \\
\frac{\partial f_2}{\partial N_1} & \frac{\partial f_2}{\partial N_2}
\end{pmatrix}
\end{equation}
$$

In contrast with the previous part where we had 2 equations, here we have 4 terms in the matrix, in particular 4 partial derivatives. After finding the fixed points, by resolving the equations detailed in the first part, now we can easily replace the values of $N1^{*}$ and $N2^{*}$ in the Jacobian Matrix and then study the stability of the fixed points.

In the analytic approach, the stability of a fixed point ($N1^{*}$, $N2^{*}$) is related to the signs of the real parts of the **eigenvalues** â€‹â€‹of $Jac(N1^{*},N2^{*})$:

-   ($N1^{*}$, $N2^{*}$) is locally **asymptotically stable (LAS)** if all its eigenvalues are (with real parts) \<0

-   ($N1^{*}$, $N2^{*}$) is **unstable** otherwise, including:

    **repulsor** if all eigenvalues â€‹â€‹are (with real parts) \>0

    **saddle point** if some eigenvalues are (with real parts) \<0 and the others (with real parts) \>0.

Because the matrix $Jac(N1^{*},N2^{*})$ is of dimension 2, it has exactly two eigenvalues and we can calculate the Trace (sum of the eigenvalues ) and the Determinant (product of the eigenvalues) of the Jacobian Matrix which will help us to determine the stability of the fixed points. If a Jacobian Matrix is defined as followed :

$$
\begin{equation}
Jac(N_1^*, N_2^*) =
\begin{pmatrix}
a & b \\
c & d
\end{pmatrix}
\end{equation}
$$

The Trace and the Determinant correspond to : ğ‘‡ğ‘Ÿğ‘ğ‘ğ‘’ = ğ‘ + ğ‘‘ and ğ·ğ‘’ğ‘¡ = ğ‘ğ‘‘ âˆ’ ğ‘ğ‘.

In particular,

-   ($N1^{*}$, $N2^{*}$) is locally **asymptotically stable (LAS)** if Trace \<0 and Det \>0.
-   ($N1^{*}$, $N2^{*}$) is **repulsor** if Trace \> 0 and Det \>0.
-   ($N1^{*}$, $N2^{*}$) is **saddle point** if Det \< 0 (whatever the Trace).

**CONCLUSION :**
