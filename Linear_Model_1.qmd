---
title: "Penguins"
format: html
editor: visual
bibliography: references.bib
---

# I) Introduction

# i) General Linear Model

We present here, a reminder sheet on the General Linear Model (GLM) and its specific features. Its use will be illustrated with an example applied to ecological data on penguins from @Gorman2014.

Note : The concepts covered in this reminder sheet are taken from our Master's lectures, written by Y.Outreman and then taught by A. Masson. During these courses, we learned how to explore data and then analyze it using this type of model.

The objective of the GLM is to explain a dependent variable as a function of independent explanatory variables measured on statistical units from a sample of a population. This type of model is generally constructed as follows:

Y = β\*X + ε

Y is the response (dependent) variable to be explained. X is an explanatory (independent) variable that can explain Y. There can be several in the model. βi represents a coefficient, placed in front of the X variables, to measure their effect on the response variable. ε represents the errors in the model, i.e. what the model cannot explain.

There are three general types of linear models:

-   Linear regression
-   Analysis of variance (ANOVA)
-   Analysis of variance-covariance (ANCOVA)

They each have their own specific characteristics and depend on the nature of the independent variables X, which can be quantitative or qualitative. The response variable Y is always quantitative.

Linear regression is used when we want to determine whether a linear relationship exists between the response variable Y and one or more quantitative X variables (then called covariates).

ANOVA is used when the explanatory variables X are qualitative (then called factors). These qualitative X variables often have multiple categories (levels).

ANCOVA is used when we want to model the variable Y as a function of several X variables, which can be qualitative and quantitative.

Another important aspect to consider is that for this type of model to be valid, three conditions must be met:
-   the model residuals must follow a normal distribution
-   homoscedasticity (homogeneity of the variance of the residuals) must be respected
-   the residuals are independent

These conditions are systematically verified after modeling : the verification will be illustrated in the following example.

# ii) Presentation of data and objectives of the analysis

In this application example, we will use data from a study conducted by Dr. Kristen Gorman, who studied the physical characteristics of three species of penguins in the Palmer Archipelago in Antarctica. The data was collected on three islands of the archipelago in 2007, 2008, and 2009.

The researcher noted the following characteristics in the individuals studied: 

- **species** = species of individuals, qualitative variables, 3 levels (Adelie, Gentoo, Chinstrap)
- **sex** = sex of individuals, qualitative variables, 2 levels (male, female)
- **bill_length_mm** = bill length, quantitative variable
- **bill_depth_mm** = bill depth, quantitative variable
- **flipper_length_mm** = flipper length, quantitative variable
- **body_mass_g** = body mass, quantitative variable

We also have information about the year of measurement and the island where the individuals live.  We decide not to focus on these variables while studying the model.

We will try to answer the following question :
Which quantitative and qualitative variables can explain the variation in penguin body_mass?

In this case, the response variable is body_mass, and the other variables are assumed to be explanatory variables. We want to model the variable Y as a function of several qualitative and quantitative variables, therefore we do an ANCOVA.

The model can be build like this : model <- lm (body_mass_g ~ ..., data = penguins)

# II) Data exploration

Firstly, we need to import the data, explore it, and see if there are any NA values, outliers, and so on.
The data is accessible via the package palmerpenguins (indicate source).

```{r data_importation, echo = F, include = F}
#Data importation 
library(palmerpenguins) 
data("penguins") 
penguins$sex<-as.factor(penguins$sex) 
penguins$species<-as.factor(penguins$species) 
penguins$island<-as.factor(penguins$island) 
str(penguins)
```

```{r data_NA, echo = F}
#Is NA?  
colSums(is.na(penguins))
```

There are NA values in the dataset.
We decide to remove them but there are different options for handling the presence of NA values.

## i) Check the response variable values

```{r data_response_variable, echo = F}
#Don't show the code 
par(mfrow=c(2,2),      
    mar=c(4,4,2,1),           
    bg="gray95",              
    col.axis="gray20",      
    col.lab="gray20",     
    col.main="gray20",     
    cex.axis=0.9,      
    cex.lab=1) 
col_transp <- adjustcolor("aquamarine3", alpha.f=0.5) 
# Boxplot 
boxplot(penguins$bill_depth_mm,         
        col=col_transp, border="gray30",         
        ylab='Bill depth (mm)',         
        main = 'Boxplot',         
        notch=TRUE) 
# Cleveland plot 
dotchart(penguins$bill_depth_mm,          
         pch=16, col=col_transp,          
         xlab='Bill depth (mm)',          
         main = 'Cleveland plot',          
         cex=0.8) 
# Histogram 
hist(penguins$bill_depth_mm,      
     col=col_transp, 
     border="white",      
     xlab="Bill depth (mm)",      
     main = 'Histogram',      
     breaks=20)
# Quantile-Quantile plot 
qqnorm(penguins$bill_depth_mm, pch=16, col=col_transp, xlab='', ylab='',main="QQ plot") 
qqline(penguins$bill_depth_mm, col='red', lwd=2)
```

It seems that there are no outliers in the Y variable or its distribution. From the Cleveland plot, we can observe three distinct clusters of points, likely corresponding to the three different penguin species. The histogram shows two main peaks in the range of bill lengths, but no clear outliers. Overall, the data appear to follow a Gaussian distribution, which is consistent with species-specific traits. However, Y normality is not a required assumption for our model.

## ii) Check the explain variables values

```{r data_quantitative_explain_variables, echo = F}
#Don't show the code 
par(mfrow=c(2,2),      
    mar=c(4,4,2,1),           
    bg="gray95",              
    col.axis="gray20",      
    col.lab="gray20",      
    col.main="gray20",      
    cex.axis=0.9,      
    cex.lab=1) 
col_transp <- adjustcolor("darkgreen", alpha.f=0.5)  

# Bill lenght  
# Boxplot 
boxplot(penguins$bill_depth_mm,         
        col=col_transp, border="gray30",         
        ylab='Bill Length',         
        main = 'Boxplot',         
        notch=TRUE) 
# Cleveland plot 
dotchart(penguins$bill_length_mm,          
         pch=16,          
         col=col_transp,          
         xlab='Bill Length',          
         main = 'Cleveland plot') 
# Histogram 
hist(penguins$bill_length_mm,      
     col=col_transp,      
     xlab="Bill Length",      
     main="Histogram") 
# Quantile-Quantile plot 
qqnorm(penguins$bill_length_mm,        
       pch=16,col=col_transp,xlab='',         
       main = 'QQ plot') 
qqline(penguins$bill_length_mm,col='red',lwd=2)  

# Flipper lenght  
# Boxplot 
boxplot(penguins$bill_depth_mm,         
        col=col_transp, border="gray30",         
        ylab='Flipper Length',         
        main = 'Boxplot',         
        notch=TRUE) 
# Cleveland plot 
dotchart(penguins$flipper_length_mm,          
         pch=16,          
         col=col_transp,          
         xlab='Flipper Length',          
         main = 'Cleveland plot') 
# Histogram 
hist(penguins$flipper_length_mm,      
     col=col_transp,      
     xlab="Flipper Length",      
     main="Histogram") 
# Quantile-Quantile plot 
qqnorm(penguins$flipper_length_mm,        
       pch=16,        
       col=col_transp,xlab='',        
       main = 'QQ plot') 
qqline(penguins$flipper_length_mm,col='red',lwd=2)  

# Body mass 
# Boxplot 
boxplot(penguins$bill_depth_mm,         
        col=col_transp, border="gray30",         
        ylab='Body Mass',         
        main = 'Boxplot',         
        notch=TRUE) 
# Cleveland plot 
dotchart(penguins$body_mass_g,          
         pch=16,          
         col=col_transp,          
         xlab='Body Mass',          
         main = 'Cleveland plot') 
# Histogram 
hist(penguins$body_mass_g,      
     col=col_transp,     
     xlab="Body Mass",      
     main="Histogram") 
# Quantile-Quantile plot 
qqnorm(penguins$body_mass_g,        
       pch=16,        
       col=col_transp,xlab='',        
       main = 'QQ plot') 
qqline(penguins$body_mass_g,col='red',lwd=2)
```

There appear to be no outliers for any of the quantitative variables. From the Cleveland plot, we can observe two distinct clusters for the bill length variable, which may be related to sexual dimorphism. This distinct distribution is also visible in the corresponding histogram. For flipper length, two main peaks are observed, but the Cleveland plot reveals three distinct clusters. Similarly, the body mass variable shows three clusters, even though the histogram displays only a single peak. All variables seem to follow a Gaussian distribution, although this assumption is not required for the Y variable in our model. Nevertheless, visualizing the distributions of the quantitative X variables allows us to formulate hypotheses regarding species differences and sexual dimorphism.

```{r data_qualitative_explain_variables, echo = F}
summary(penguins$species) 
summary(penguins$island) 
summary(penguins$sex)
```

Some groups are under-represented, particularly within the island and species categories. We will exclude island from the model due to this imbalance. However, we will retain species, as it may capture important differences between groups.

## iii) Analyse the potential relation between Y and Xs

```{r data_exploration_relation, echo = F, fig.height=8, fig.width=6}
par(mfrow=c(3,2)) 
# Bill Length 
plot(penguins$bill_depth_mm~penguins$bill_length_mm,pch=16,col='olivedrab4',xlab='Bill Length',ylab='Bill Depth') 
# Flipper Length 
plot(penguins$bill_depth_mm~penguins$flipper_length_mm,pch=16,col='olivedrab4',xlab='Flipper Length',ylab='Bill Depth') 
# Body Mass 
plot(penguins$bill_depth_mm~penguins$body_mass_g,pch=16,col='olivedrab4',xlab='Body Mass',ylab='Bill Depth') 
# Sex 
boxplot(penguins$bill_depth_mm~penguins$sex, varwidth = TRUE, ylab = "Bill Depth", xlab = "Sex", col='darkgrey', main = "") 
# Species 
boxplot(penguins$bill_depth_mm~penguins$species, varwidth = TRUE, ylab = "Bill Depth", xlab = "Species", col='brown', main = "") 
```

There appears to be a positive linear relationship between bill depth and all other quantitative variables, with at least two distinct trends visible in each case. A sexual dimorphism seems observed: females tending to have shorter bill depths than males. Additionally, there may be species differences : Gentoo penguins seem to have smaller bill depths compared to Adelie and Chinstrap penguins, which show similar bill depth measurements.

## iv) Analyse the eventual interactions between Xs qualitative variables

This section aims to check for potential interaction effects between the two qualitative variables. To do so, all combinations of their categories must be present in the data.

```{r data_cross_qualitative_exploration, echo = F}
table(penguins$species, penguins$sex) 
table(penguins$species, penguins$island)
```

All categories are present and well balanced across the factors, allowing us to test for potential interactions between them. However, some information related to the island variable is missing across certain categories, so this variable will be excluded from the model.

```{r data_qualitative_interaction, echo = F}
par(mfrow=c(1,1)) 
boxplot(penguins$bill_depth_mm~penguins$sex*penguins$species, varwidth = TRUE, ylab = "Bill Depth", col='brown1', main = "",cex.axis=0.7)
```

Both factors species and sex seems to interact.

```{r data_interaction_qualitative_quantitative, echo = F}
par(mfrow=c(2,1)) 
# Interactions between Bill Length & Sex 
plot(penguins$bill_depth_mm~penguins$bill_length_mm,type='n',ylab = "Bill Depth",xlab="Bill Length") 
points(penguins$bill_depth_mm[penguins$sex=="male"]~penguins$bill_depth_mm[penguins$sex=="male"],pch=16,col='darkolivegreen4') 
points(penguins$bill_depth_mm[penguins$sex=="female"]~penguins$bill_length_mm[penguins$sex=="female"],pch=17,col='darkorchid')  

# Interactions between Bill Length & Species 
plot(penguins$bill_depth_mm~penguins$bill_length_mm,type='n',ylab = "Bill depth",xlab="Bill Length") 
points(penguins$bill_depth_mm[penguins$species=="Adelie"]~penguins$bill_length_mm[penguins$species=="Adelie"],pch=16,col='olivedrab') 
points(penguins$bill_depth_mm[penguins$species=="Chinstrap"]~penguins$bill_length_mm[penguins$species=="Chinstrap"],pch=17,col='lightsalmon3') 
points(penguins$bill_depth_mm[penguins$species=="Gentoo"]~penguins$bill_length_mm[penguins$species=="Gentoo"],pch=17,col='orange3')

par(mfrow=c(2,1)) 

# Interactions between Flipper Length & Sex 
plot(penguins$bill_depth_mm~penguins$flipper_length_mm,type='n',ylab = "Bill Depth",xlab="Flipper Length") 
points(penguins$bill_depth_mm[penguins$sex =="male"]~penguins$flipper_length_mm[penguins$sex=="male"],pch=16,col='darkolivegreen4') 
points(penguins$bill_depth_mm[penguins$sex=="female"]~penguins$flipper_length_mm[penguins$sex=="female"],pch=17,col='darkorchid')  

# Interactions between Flipper Length & Species 
plot(penguins$bill_depth_mm~penguins$flipper_length_mm,type='n',ylab = "Bill Length",xlab="Flipper Length") 
points(penguins$bill_depth_mm[penguins$species=="Adelie"]~penguins$flipper_length_mm[penguins$species=="Adelie"],pch=16,col='olivedrab') 
points(penguins$bill_depth_mm[penguins$species=="Chinstrap"]~penguins$flipper_length_mm[penguins$species=="Chinstrap"],pch=17,col='lightsalmon3') 
points(penguins$bill_depth_mm[penguins$species=="Gentoo"]~penguins$flipper_length_mm[penguins$species=="Gentoo"],pch=17,col='orange3')

par(mfrow=c(2,1)) 

# Interactions between Body Mass & Sex 
plot(penguins$bill_depth_mm~penguins$body_mass_g,type='n',ylab = "Bill Depth",xlab="Body Mass")
points(penguins$bill_depth_mm[penguins$sex=="male"]~penguins$body_mass_g[penguins$sex=="male"],pch=16,col='darkolivegreen4') 
points(penguins$bill_depth_mm[penguins$sex=="female"]~penguins$body_mass_g[penguins$sex=="female"],pch=17,col='darkorchid')  

# Interactions between Body Mass & Species 
plot(penguins$bill_depth_mm~penguins$body_mass_g,type='n',ylab = "Bill Length",xlab="Body Mass") 
points(penguins$bill_depth_mm[penguins$species=="Adelie"]~penguins$body_mass_g[penguins$species=="Adelie"],pch=16,col='olivedrab') 
points(penguins$bill_depth_mm[penguins$species=="Chinstrap"]~penguins$body_mass_g[penguins$species=="Chinstrap"],pch=17,col='lightsalmon3') 
points(penguins$bill_depth_mm[penguins$species=="Gentoo"]~penguins$body_mass_g[penguins$species=="Gentoo"],pch=17,col='orange3')
```
