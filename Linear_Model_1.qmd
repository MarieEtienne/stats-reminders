---
title: "Penguins"
format: html
editor: visual
---

# I) Introduction

General linear model

Nous présentons ici une fiche rappel sur le modèle linéaire général et ses spécificités. Son utilisation sera illustrée à travers un exemple appliqué à des données écologiques sur les manchots.

Point important : les concepts abordés dans cette fiche récapitulative sont tirés de nos cours et TD de Master écrits et dispensés par plusieurs professeurs (A. Masson et Y. Outreman). Durant ces cours, nous avons appris à explorer les données puis les analyser à l’aide de ce type de modèle (mettre un lien vers une page web)

L’objectif du modèle linéaire est d’expliquer une variable dépendante en fonction de variables indépendantes explicatives mesurées sur des unités statistiques d’un échantillon d’une population. Ce type de modèle se construit généralement de la façon suivante :

Y = β\*X + ε

Y est la variable réponse (dépendante) qui est à expliquer. X est une variable explicative (indépendante) permettant d’expliquer Y. Il peut y en avoir plusieurs dans le modèle. β représente un coefficient, placé devant les X, il permet de mesurer leur effet sur la variable réponse. ε représente les erreurs dans le modèle, c’est à dire ce que le modèle ne permet pas d’expliquer.

Il existe trois types de modèles linéaires généraux :

-   la régression linéaire
-   l’analyse de variance (ANOVA)
-   l’analyse de variance - covariance (ANCOVA)

Ils ont chacun leurs spécificités et dépendent de la nature des variables indépendantes X, qui peuvent être quantitatives ou qualitatives. La variable réponse Y est toujours quantitative.

La régression linéaire s’applique lorsque l’on souhaite voir si une relation linéaire existe entre la variable réponse Y et une ou plusieurs variables X quantitatives (alors appelées covariables).

L’ANOVA est le modèle linéaire général utilisé lorsque les variables explicatives X sont qualitatives (alors appelées facteurs). Ces variables X qualitatives ont souvent plusieurs catégories appelées modalités.

L’ANCOVA est utilisée lorsque l’on souhaite modéliser la variable Y en fonction de plusieurs variables X qui peuvent être qualitatives et/ou quantitatives.

Choisir le bon modèle nécessite donc de connaître le type de variables que l’on souhaite étudier avant de commencer la modélisation.

Un autre aspect important est à prendre en compte : pour que l’utilisation de ce type de modèle soit valide, trois conditions sont à respecter :

les erreurs (résidus) doivent suivre une loi normale le principe d’homoscedasticité (homogénéité de la variance des résidus) doit être respecté les résidus ne sont pas corrélés, les observations sont indépendantes

Ces conditions sont systématiquement vérifiées après la modélisation : l’application de cette vérification sera illustrée dans l’exemple choisi.

# II) Data exploration

```{r data_importation, echo = F, include = F}
#Data importation
library(palmerpenguins)
data("penguins")
penguins$sex<-as.factor(penguins$sex)
penguins$species<-as.factor(penguins$species)
penguins$island<-as.factor(penguins$island)
str(penguins)
```

```{r data_NA, echo = F}
#Is NA? 
colSums(is.na(penguins))
```

There is NA values in the data set.

## i) Check the response variable values

```{r data_response_variable, echo = F}
#Don't show the code
par(mfrow=c(2,2), 
    mar=c(4,4,2,1),      
    bg="gray95",         
    col.axis="gray20", 
    col.lab="gray20", 
    col.main="gray20", 
    cex.axis=0.9, 
    cex.lab=1)
col_transp <- adjustcolor("aquamarine3", alpha.f=0.5)
# Boxplot
boxplot(penguins$bill_depth_mm,
        col=col_transp, border="gray30",
        ylab='Bill depth (mm)',
        main = 'Boxplot',
        notch=TRUE)
# Cleveland plot
dotchart(penguins$bill_depth_mm,
         pch=16, col=col_transp,
         xlab='Bill depth (mm)',
         main = 'Cleveland plot',
         cex=0.8)
# Histogram
hist(penguins$bill_depth_mm,
     col=col_transp, border="white",
     xlab="Bill depth (mm)",
     main = 'Histogram',
     breaks=20)
# Quantile-Quantile plot
qqnorm(penguins$bill_depth_mm,
       pch=16, col=col_transp,
       xlab='', ylab='',
       main="QQ plot")
qqline(penguins$bill_depth_mm, col='red', lwd=2)
```

It seems that there are no outliers in the Y variable or its distribution. From the Cleveland plot, we can observe three distinct clusters of points, likely corresponding to the three different penguin species. The histogram shows two main peaks in the range of bill lengths, but no clear outliers. Overall, the data appear to follow a Gaussian distribution, which is consistent with species-specific traits. However, Y normality is not a required assumption for our model.

## ii) Check the explain variables values

```{r data_quantitative_explain_variables, echo = F}
#Don't show the code
par(mfrow=c(2,2), 
    mar=c(4,4,2,1),      
    bg="gray95",         
    col.axis="gray20", 
    col.lab="gray20", 
    col.main="gray20", 
    cex.axis=0.9, 
    cex.lab=1)
col_transp <- adjustcolor("darkgreen", alpha.f=0.5)

# Bill lenght 
# Boxplot
boxplot(penguins$bill_depth_mm,
        col=col_transp, border="gray30",
        ylab='Bill Length',
        main = 'Boxplot',
        notch=TRUE)
# Cleveland plot
dotchart(penguins$bill_length_mm,
         pch=16,
         col=col_transp,
         xlab='Bill Length', 
         main = 'Cleveland plot')
# Histogram
hist(penguins$bill_length_mm,
     col=col_transp,
     xlab="Bill Length",
     main="Histogram")
# Quantile-Quantile plot
qqnorm(penguins$bill_length_mm,
       pch=16,col=col_transp,xlab='', 
       main = 'QQ plot')
qqline(penguins$bill_length_mm,col='red',lwd=2)

# Flipper lenght 
# Boxplot
boxplot(penguins$bill_depth_mm,
        col=col_transp, border="gray30",
        ylab='Flipper Length',
        main = 'Boxplot',
        notch=TRUE)
# Cleveland plot
dotchart(penguins$flipper_length_mm,
         pch=16,
         col=col_transp,
         xlab='Flipper Length',
         main = 'Cleveland plot')
# Histogram
hist(penguins$flipper_length_mm,
     col=col_transp,
     xlab="Flipper Length",
     main="Histogram")
# Quantile-Quantile plot
qqnorm(penguins$flipper_length_mm,
       pch=16,
       col=col_transp,xlab='',
       main = 'QQ plot')
qqline(penguins$flipper_length_mm,col='red',lwd=2)

# Body mass
# Boxplot
boxplot(penguins$bill_depth_mm,
        col=col_transp, border="gray30",
        ylab='Body Mass',
        main = 'Boxplot',
        notch=TRUE)
# Cleveland plot
dotchart(penguins$body_mass_g,
         pch=16,
         col=col_transp,
         xlab='Body Mass',
         main = 'Cleveland plot')
# Histogram
hist(penguins$body_mass_g,
     col=col_transp,
     xlab="Body Mass",
     main="Histogram")
# Quantile-Quantile plot
qqnorm(penguins$body_mass_g,
       pch=16,
       col=col_transp,xlab='',
       main = 'QQ plot')
qqline(penguins$body_mass_g,col='red',lwd=2)
```

There appear to be no outliers for any of the quantitative variables. From the Cleveland plot, we can observe two distinct clusters for the bill length variable, which may be related to sexual dimorphism. This distinct distribution is also visible in the corresponding histogram. For flipper length, two main peaks are observed, but the Cleveland plot reveals three distinct clusters. Similarly, the body mass variable shows three clusters, even though the histogram displays only a single peak. All variables seem to follow a Gaussian distribution, although this assumption is not required for the Y variable in our model. Nevertheless, visualizing the distributions of the quantitative X variables allows us to formulate hypotheses regarding species differences and sexual dimorphism.

```{r data_qualitative_explain_variables, echo = F}
summary(penguins$species)
summary(penguins$island)
summary(penguins$sex)
```

Some groups are under-represented, particularly within the island and species categories. We will exclude island from the model due to this imbalance. However, we will retain species, as it may capture important differences between groups.

## iii) Analyse the potantiel relation between Y and Xs

```{r data_exploration_relation, echo = F, fig.height=8, fig.width=6}
par(mfrow=c(3,2))
# Bill Length
plot(penguins$bill_depth_mm~penguins$bill_length_mm,pch=16,col='olivedrab4',xlab='Bill Length',ylab='Bill Depth')
# Flipper Length
plot(penguins$bill_depth_mm~penguins$flipper_length_mm,pch=16,col='olivedrab4',xlab='Flipper Length',ylab='Bill Depth')
# Body Mass
plot(penguins$bill_depth_mm~penguins$body_mass_g,pch=16,col='olivedrab4',xlab='Body Mass',ylab='Bill Depth')
# Sex
boxplot(penguins$bill_depth_mm~penguins$sex, varwidth = TRUE, ylab = "Bill Depth", xlab = "Sex", col='darkgrey', main = "")
# Species
boxplot(penguins$bill_depth_mm~penguins$species, varwidth = TRUE, ylab = "Bill Depth", xlab = "Species", col='brown', main = "")

```

There appears to be a positive linear relationship between bill depth and all other quantitative variables, with at least two distinct trends visible in each case. A sexual dimorphism seems observed: females tending to have shorter bill depths than males. Additionally, there may be species differences : Gentoo penguins seem to have smaller bill depths compared to Adelie and Chinstrap penguins, which show similar bill depth measurements.

## iv) Analyse the eventual interactions between Xs  qualitative variables

This section aims to check for potential interaction effects between the two qualitative variables. To do so, all combinations of their categories must be present in the data.

```{r data_cross_qualitative_exploration, echo = F}
table(penguins$species, penguins$sex)
table(penguins$species, penguins$island)
```

All categories are present and well balanced across the factors, allowing us to test for potential interactions between them. However, some information related to the island variable is missing across certain categories, so this variable will be excluded from the model.

```{r}
par(mfrow=c(1,1))
boxplot(penguins$bill_depth_mm~penguins$sex*penguins$species, varwidth = TRUE, ylab = "Bill Depth", col='brown1', main = "",cex.axis=0.7)
```

Both factors species and sex seems to interact.

```{r data_interaction_qualitative_quantitative, echo = F}
par(mfrow=c(2,1))
# Interactions between Bill Length & Sex
plot(penguins$bill_depth_mm~penguins$bill_length_mm,type='n',ylab = "Bill Depth",xlab="Bill Length")
points(penguins$bill_depth_mm[penguins$sex=="male"]~penguins$bill_depth_mm[penguins$sex=="male"],pch=16,col='darkolivegreen4')
points(penguins$bill_depth_mm[penguins$sex=="female"]~penguins$bill_length_mm[penguins$sex=="female"],pch=17,col='darkorchid')

# Interactions between Bill Length & Species
plot(penguins$bill_depth_mm~penguins$bill_length_mm,type='n',ylab = "Bill depth",xlab="Bill Length")
points(penguins$bill_depth_mm[penguins$species=="Adelie"]~penguins$bill_length_mm[penguins$species=="Adelie"],pch=16,col='olivedrab')
points(penguins$bill_depth_mm[penguins$species=="Chinstrap"]~penguins$bill_length_mm[penguins$species=="Chinstrap"],pch=17,col='lightsalmon3')
points(penguins$bill_depth_mm[penguins$species=="Gentoo"]~penguins$bill_length_mm[penguins$species=="Gentoo"],pch=17,col='orange3')

par(mfrow=c(2,1))
# Interactions between Flipper Length & Sex
plot(penguins$bill_depth_mm~penguins$flipper_length_mm,type='n',ylab = "Bill Depth",xlab="Flipper Length")
points(penguins$bill_depth_mm[penguins$sex=="male"]~penguins$flipper_length_mm[penguins$sex=="male"],pch=16,col='darkolivegreen4')
points(penguins$bill_depth_mm[penguins$sex=="female"]~penguins$flipper_length_mm[penguins$sex=="female"],pch=17,col='darkorchid')

# Interactions between Flipper Length & Species
plot(penguins$bill_depth_mm~penguins$flipper_length_mm,type='n',ylab = "Bill Length",xlab="Flipper Length")
points(penguins$bill_depth_mm[penguins$species=="Adelie"]~penguins$flipper_length_mm[penguins$species=="Adelie"],pch=16,col='olivedrab')
points(penguins$bill_depth_mm[penguins$species=="Chinstrap"]~penguins$flipper_length_mm[penguins$species=="Chinstrap"],pch=17,col='lightsalmon3')
points(penguins$bill_depth_mm[penguins$species=="Gentoo"]~penguins$flipper_length_mm[penguins$species=="Gentoo"],pch=17,col='orange3')


par(mfrow=c(2,1))
# Interactions between Body Mass & Sex
plot(penguins$bill_depth_mm~penguins$body_mass_g,type='n',ylab = "Bill Depth",xlab="Body Mass")
points(penguins$bill_depth_mm[penguins$sex=="male"]~penguins$body_mass_g[penguins$sex=="male"],pch=16,col='darkolivegreen4')
points(penguins$bill_depth_mm[penguins$sex=="female"]~penguins$body_mass_g[penguins$sex=="female"],pch=17,col='darkorchid')

# Interactions between Body Mass & Species
plot(penguins$bill_depth_mm~penguins$body_mass_g,type='n',ylab = "Bill Length",xlab="Body Mass")
points(penguins$bill_depth_mm[penguins$species=="Adelie"]~penguins$body_mass_g[penguins$species=="Adelie"],pch=16,col='olivedrab')
points(penguins$bill_depth_mm[penguins$species=="Chinstrap"]~penguins$body_mass_g[penguins$species=="Chinstrap"],pch=17,col='lightsalmon3')
points(penguins$bill_depth_mm[penguins$species=="Gentoo"]~penguins$body_mass_g[penguins$species=="Gentoo"],pch=17,col='orange3')
```
