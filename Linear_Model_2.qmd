---
title: "GENERALIZED LINEAR MIXED MODEL"
subtitle: "BADGER EXAMPLE"
author: [Mathilde Duclos, Lily Houles, Adèle Kieffer, Lokian Le Gal-Audebourg, Valentin Lucas, Lyssandre Marchand, Quentin Petitjean]
format:
  html:
    code-fold: true
editor: visual
bibliography: references.bib
---

# **GENERAL INTRODUCTION**

::: {#GLMMs}
We present here a reminder sheet on **Generalized Linear Mixed Models** [(GLMMs)](#GLMMsBACK) and its specific features. Its use will be illustrated through a study applied on badgers from @Walker2009 .
:::

::: {.callout-note appearance="simple"}
## Note

The concepts covered in this reminder sheet are taken from our Master's lectures and tutorials, written by @Y_Outreman and taught by @A_Masson .
:::

## **Generalities**

General Linear Models are traditionally used to describe the relationship between a continuous response ($Y$) and one or more explanatory variables ($X_{1}$,$X_{2}$...$X_{p}$). They rely on three main assumptions : *independence of residuals*, *normality of residuals* and *homogeneity of variances* (homoscedasticity). However, in many fields (ecology, epidemiology, etc), the response variable ($Y$) is **discrete**, for example it can take the form of *counts*, *binary outcomes* (presence/absence), and so on.

Applying a General Linear Model to this type of data is problematic for two main reasons:

-   For discrete responses, the variance of $Y$ typically depends on its **mean-variance relationship**. As a result, the variance is not constant across observations, directly invalidating the assumption of homogeneity.

-   Fitting a General Linear Model to count data also leads to **negative predicted values and non-normal residuals**, which are not interpretable given the nature of the response variable.

In short, General Linear Models are not well-suited for discrete responses. Hence, we need specific tools to analyse discrete response data. These are **Generalized Linear Models (GLMs)**.

## **Structure of a Generalized Linear Model**

A **Generalized Linear Model** extends the classical linear model through three steps:

1.  **Assumption of the distribution** : the distribution of the response variable $Y_{i}$ is assumed to belong to a certain distribution law (e.g. Poisson, Binomial, Gamma)

2.  **Specification of the systematic part** : This is the linear function of the explanatory variables (the linear predictor called $\eta$)

3.  **The link function** ($g$) : This defines the relationship between the expected mean value of $Y_{i}$ and the systematic part $\eta$.

A Generalized Linear Model can be written as : $$g(\mu_{y})= \alpha+ \beta_{1}.X{i1}+ \beta_{2}.X{i2}+\beta_{3}.X{i3}+...\beta_{p}.X{ip} = \eta $$

The linear predictor $\eta$, emerges from the linear model as a sum of the terms for each of the $p$ parameters. This is not a direct value of $Y$. The value of $\eta$ is obtained by transforming the value of $Y$ by the link function, and the predicted value of $Y$ is obtained by applying the inverse link function to $\eta$.

## **From Generalized Linear Model to Generalized Linear Mixed Model**

Depending on the sampling design or the experimental setup, independence of residuals is not respected as some statistical units are related. To account for this dependence structure, we can include **random effects** in the model.

::: {#GLMMsBACK}
The resulting model, called **Generalized Linear Mixed Model** **(GLMM)** extends the Generalized Linear Model by adding these random effects alongside the fixed effects. Therefore, [GLMMs](#GLMMs) allow us to model both the relationship between predictors, responses and the non-independence in the data.
:::

# **DATA PRESENTATION AND OBJECTIVES**

The data used come from @Walker2009 and consist of signs of badger (*Meles meles*) activity around farms located in the southwest of England, where badger density is high. This study was carried out in the context of bovine tuberculosis and its possible transmission to cattle through badgers. Reducing the number of farm visits by badgers (especially in places where they might come into contact with livestock) could help limit the spread of the disease. 

Thus, the aim of this study is **to predict the occurrence of signs of badger activity on farms**, using the dataset presented below and an appropriate model.

Between autumn 2003 and summer 2005, a survey was conducted on 36 different farms; the data are therefore longitudinal, since each farm was monitored over eight consecutive seasons. Within the same farm, observations may be autocorrelated. This is an aspect that we will take into account while analyzing the data.

The response variable (presence or absence of signs of badger activity) is binary : it takes the value 1 when signs of activity were detected, and 0 otherwise. Signs of activity include the presence of feces, setts, or feeding traces.

The data are available in the file `Badger.txt`. The variables are:

-   `year` : studied year
-   `season` : 1 = spring, 2 = summer, 3 = autumn, 4 = winter
-   `farm_code_numeric` : farm identifier
-   `survey` : survey identifier (time indicator)
-   `signs_in_yard` : binary indicator of badger activity (response variable)
-   `no_setts_in_fields` : number of setts
-   `no_active_setts_in_fields` : number of actively occupied setts
-   `no_buildings` : number of buildings in the farm
-   `no_cattle_in_buildings_yard` : number of cattle in building yards
-   `accessible_feed_store_present` : presence / absence of an accessible feed store
-   `accessible_cattle_house_present` : presence / absence of a direct access to the cattle house
-   `accessible_feed_present` : presence / absence of accessible feed in the farm
-   `grass_silage` : presence / absence of grass silage
-   `cereal_silage` : presence / absence of cereal silage
-   `hay_straw` : presence / absence of hay and / or straw
-   `cereal_grains` : presence / absence of cereal grains
-   `concentrates` : presence / absence of concentrates
-   `proteinblocks` : presence / absence of protein blocks
-   `sugar_beet` : presence / absence of sugar beet
-   `vegetables` : presence / absence of vegetables
-   `molasses` : presence / absence of molasses

To visualize the subject of our analysis, please see Figure @fig-badger.

::: {#fig-badger}
![Badger in a garden](images/badger1.jpg)
:::

## **Data import**

```{r libraries, message = FALSE}
# library import
library(corrplot)
library(lme4)
library(rsq)
```
Let's import the dataset and tansform some variables into factors for the analysis. We also check for missing values.

```{r global data, include=TRUE,echo=TRUE}
# Dataset import
dataBadger <- read.table("Badger.txt", dec=".", header = TRUE)

# Change categorical variables to factors
dataBadger$season<-as.factor(dataBadger$season)
dataBadger$accessible_feed_store_present<-as.factor(dataBadger$accessible_feed_store_present)
dataBadger$accessible_cattle_house_present<-as.factor(dataBadger$accessible_cattle_house_present)
dataBadger$accessible_feed_present<-as.factor(dataBadger$accessible_feed_present)
dataBadger$grass_silage<-as.factor(dataBadger$grass_silage)
dataBadger$cereal_silage<-as.factor(dataBadger$cereal_silage)
dataBadger$hay_straw<-as.factor(dataBadger$hay_straw)
dataBadger$cereal_grains<-as.factor(dataBadger$cereal_grains)
dataBadger$concentrates<-as.factor(dataBadger$concentrates)
dataBadger$sugar_beet<-as.factor(dataBadger$sugar_beet)
dataBadger$molasses<-as.factor(dataBadger$molasses)

# Check for presence of missing values
colSums(is.na(dataBadger))
```
There are no missing value in the dataset.

## **Data exploration**

Before carrying out any statistical modeling, it is essential to perform a thorough **data exploration**. This step helps identify potential issues such as outliers, collinearity, or imbalanced distributions that could bias the results or invalidate model assumptions.

### **1. Outliers and Distribution of** $Y$

Since $Y$ is a binary variable, it does not have a continuous distribution. Instead, we inspect the frequency of each category (0 and 1) to check for imbalance in the response variable.

```{r, include=TRUE}
# Number of 0 and 1 in Y
table(dataBadger$signs_in_yard)
```

### **2. Outliers and distributions of quantitative predictors** ($X$)

For continuous independent variables, it is important to:

-   Detect potential **outliers** (e.g., extreme or erroneous values)

-   Visualize the **shape of the distribution** (e.g., normal, skewed, multimodal)

-   Assess whether **transformations** (e.g., log, square root) might be needed before modeling

The following visualizations help achieve this:

-   **Cleveland dot plots**: to identify potential outliers

-   **Histograms**: to visualize the overall distribution

-   **Q-Q plots**: to assess normality assumptions

```{r dataCov, include=TRUE, fig.height=8, fig.width=8}
par(mfrow=c(3,3))

# Number of badger setts on farm
# Cleveland plot
dotchart(dataBadger$N_setts_in_fields,pch=16,col='blue',xlab='Number of setts')
# Histogram
hist(dataBadger$N_setts_in_fields,col='blue',xlab="Number of setts",main="")
# Quantile-Quantile plot
qqnorm(dataBadger$N_setts_in_fields,pch=16,col='blue',xlab='')
qqline(dataBadger$N_setts_in_fields,col='red')

# Number of buildings on farm
# Cleveland plot
dotchart(dataBadger$N_buildings,pch=16,col='blue',xlab='Number of buildings')
# Histogram
hist(dataBadger$N_buildings,col='blue',xlab="Number of buildings",main="")
# Quantile-Quantile plot
qqnorm(dataBadger$N_buildings,pch=16,col='blue',xlab='')
qqline(dataBadger$N_buildings,col='red')

# Number of cattle housed in buildings on farm
# Cleveland plot
dotchart(dataBadger$N_cattle_in_buildings_yard,pch=16,col='blue',xlab='Number of cattle')
# Histogram
hist(dataBadger$N_cattle_in_buildings_yard,col='blue',xlab="Number of cattle",main="")
# Quantile-Quantile plot
qqnorm(dataBadger$N_cattle_in_buildings_yard,pch=16,col='blue',xlab='')
qqline(dataBadger$N_cattle_in_buildings_yard,col='red')
```

The exploratory plots show that all three quantitative variables (number of setts, number of buildings, and number of cattle) display right-skewed distributions, with most farms having relatively low values and a few having much higher ones. No extreme or abnormal outliers are clearly visible, although some high values are present, especially for the number of cattle. The Q-Q plots confirm that none of these variables follow a normal distribution.

### **2. Categorical variables: number of levels and individuals per level**

For categorical variables (factors), it is important to examine the number of levels (categories) and the number of observations in each level. This helps identify potential issues such as:

-   Levels with very few observations (which may cause estimation problems in statistical models)

-   Highly unbalanced distributions between categories

-   Unexpected or erroneous category labels

The following code summarizes the distribution of individuals across levels for each categorical predictor:

```{r datafact, include=TRUE, echo=TRUE}
# Factor season
summary(dataBadger$season)
# Factor accessible_feed_store_present
summary(dataBadger$accessible_feed_store_present)
# Factor accessible_cattle_house_present 
summary(dataBadger$accessible_cattle_house_present )
# Factor feed
summary(dataBadger$accessible_feed_present)
# Factor grass
summary(dataBadger$grass_silage)
# Factor cereal_silage
summary(dataBadger$cereal_silage)
# Factor straw
summary(dataBadger$hay_straw)
# Factor grains
summary(dataBadger$cereal_grains)
# Factor concentrates
summary(dataBadger$concentrates)
# Factor sugar_beet
summary(dataBadger$sugar_beet)
```

Most factors are **binary**, with varying levels of balance between categories. For example, variables such as `accessible_feed_store_present`, `accessible_cattle_house_present`, and `accessible_feed_present` display moderate imbalance, with one category being more frequent than the other. The season variable has four well-represented levels, each containing a similar number of observations, which ensures adequate variability for analysis. Overall, the categorical predictors appear suitable for modelling.

### **3. Analysis of the potential relationships between** $Y$ **and the** $X$**s**

To gain preliminary insight into the relationships between the response variable (`signs_in_yard`) and the predictors, both quantitative and categorical variables were explored graphically.

Scatterplots were used to visualize how badger activity varies with continuous predictors such as the number of setts, number of buildings and number of cattle housed. These visual analyses provide a first impression of potential patterns, dependencies, or nonlinear relationships that may influence badger activity on farms.

```{r datagraph, include=TRUE, fig.height=5, fig.width=10}

par(mfrow=c(1,3))
# Number of setts
plot(dataBadger$signs_in_yard~dataBadger$N_setts_in_fields,pch=16,col='blue',xlab='Number of setts',ylab='Presence of a sign of badger activity')

# Number of buildings
plot(dataBadger$signs_in_yard~dataBadger$N_buildings,pch=16,col='blue',xlab='Number of buildings',ylab='Presence of a sign of badger activity')

# Number of cattle housed in buildings
plot(dataBadger$signs_in_yard~dataBadger$N_cattle_in_buildings_yard,pch=16,col='blue',xlab='Number of cattle',ylab='Presence of a sign of badger activity')

par(mfrow=c(2,5))
# Factor season
mosaicplot(dataBadger$signs_in_yard~dataBadger$season
           ,color=c('blue3','red2')
           ,main="Activity & Season")

# Factor feed store
mosaicplot(dataBadger$signs_in_yard~dataBadger$accessible_feed_store_present
           ,color=c('blue3','red2')
           ,main="Activity & Feed store")

# Factor accessible_cattle_house_present 
mosaicplot(dataBadger$signs_in_yard~dataBadger$accessible_cattle_house_present
           ,color=c('blue3','red2')
           ,main="Activity & cattle house")

# Factor feed
mosaicplot(dataBadger$signs_in_yard~dataBadger$accessible_feed_present
           ,color=c('blue3','red2')
           ,main="Activity & feed")
# Factor grass
mosaicplot(dataBadger$signs_in_yard~dataBadger$grass_silage
           ,color=c('blue3','red2')
           ,main="Activity & Grass")
# Factor cereal_silage
mosaicplot(dataBadger$signs_in_yard~dataBadger$cereal_silage
           ,color=c('blue3','red2')
           ,main="Activity & Cereal silage")
# Factor straw
mosaicplot(dataBadger$signs_in_yard~dataBadger$hay_straw
           ,color=c('blue3','red2')
           ,main="Activity & Straw")
# Factor grains
mosaicplot(dataBadger$signs_in_yard~dataBadger$cereal_grains
           ,color=c('blue3','red2')
           ,main="Activity & Grains")
# Factor concentrates
mosaicplot(dataBadger$signs_in_yard~dataBadger$concentrates
           ,color=c('blue3','red2')
           ,main="Activity & Concentrates")
# Factor sugar_beet
mosaicplot(dataBadger$signs_in_yard~dataBadger$sugar_beet
           ,color=c('blue3','red2')
           ,main="Activity & Sugar beet")
```

These visual analyses provide an initial understanding of how badger activity may relate on farm characteristics. Based on the scatterplots, there appears to be no clear linear relationship between badger activity and the number of setts, buildings, or cattle, although activity tends to be slightly more frequent on farms with more setts or larger number of cattle. The mosaic plots complement this by revealing possible associations between activity and certain categorical management factors, such as the presence of feed stores, cattle housing, or specific feeding practices.

### **4. Analysis of possible interactions between both independent variables**

Here, given the large number of predictors, we choose not to include interactions in modelling.

### **5. Check for collinearity between predictors** ($X$s)

To avoid multicollinearity issues during modelling, the relationships among predictor variables were examined. This step includes:

1.  Evaluating **correlations between the quantitative variables**

2.  Assessing **potential overlap between categorical factors**

3.  Exploring whether **categorical predictors influence quantitative ones** through boxplots

Given the large number of predictors, only key results are summarized below.

```{r data_collinearity, echo=TRUE, results='markup'}
# We represent plot for each continuous covariate pairs
plot(dataBadger[7:9],pch=16,col='blue')

# We calculate correlation between each pair of covariate
M<-cor(dataBadger[7:9])
corrplot.mixed(M,upper="square",lower.col="black", tl.col="black",cl.cex = 0.8,tl.cex = 0.7,number.cex =0.8)

```
A moderate positive correlation (r ≈ 0.52) is observed between the number of buildings and the number of cattle in the yard, suggesting a slight interdependence between these two variables. In contrast, the number of setts in fields shows almost no correlation with the others (r close to 0). Overall, no strong collinearity is detected, allowing these predictors to be retained for further modelling without major redundancy concerns.

We could also check collinearity between categorical independent variables and between between categorical and quantitative independent variables (mostly using boxplots), but we don't give the details here.

# **STATISTICAL ANALYSIS : GENERALIZED LINEAR MIXED MODEL (GLMM)**

Because the response variable is binary, we will use a **Generalized Linear Mixed Model (GLMM)** to examine how the different predictors influence badger activity. We assume that badger activity follows a **binomial distribution**, and we will therefore use a **logit link function**. The farm code is included as a **random effect**, to take into account the dependency between observations made in the same farm.

## **Building the model**

The best model is identified using a **backward selection procedure**. This model selection method is based on the **Akaike Information Criterion (AIC)**, which allows to take into account both the goodness of fit and the complexity of the model. Starting with the full model, the function `drop1` is used to evaluate each predictor's contribution to the AIC. The predictor whose removal leads to the smallest AIC is then removed and the model is refitted without this variable. The selection stops when the candidate model has the lowest AIC.

```{r fullmodel, include = TRUE}
mod<-glmer(signs_in_yard~N_setts_in_fields
              + N_buildings
              + N_cattle_in_buildings_yard
              + season
              + accessible_feed_store_present
              + accessible_cattle_house_present
              + accessible_feed_present
              + grass_silage
              + cereal_silage
              + hay_straw
              + cereal_grains
              + concentrates
              + sugar_beet
              + (1|farm_code)  #random effect
              ,data=dataBadger
              ,family=binomial) #for the binomial distribution
```

```{r backwardselection, include = TRUE, warning = FALSE}
#Backward selection procedure based on AIC
drop1(mod,test="Chi") # We remove season
mod1<-glmer(signs_in_yard~N_setts_in_fields
              + N_buildings
              + N_cattle_in_buildings_yard
              + accessible_feed_store_present
              + accessible_cattle_house_present
              + accessible_feed_present
              + grass_silage
              + cereal_silage
              + hay_straw
              + cereal_grains
              + concentrates
              + sugar_beet
              + (1|farm_code)
              ,data=dataBadger
              ,family=binomial)

drop1(mod1,test="Chi") # We remove concentrates
mod2<-glmer(signs_in_yard~N_setts_in_fields
              + N_buildings
              + N_cattle_in_buildings_yard
              + accessible_feed_store_present
              + accessible_cattle_house_present
              + accessible_feed_present
              + grass_silage
              + cereal_silage
              + hay_straw
              + cereal_grains
              + sugar_beet
              + (1|farm_code)
              ,data=dataBadger
              ,family=binomial)

drop1(mod2,test="Chi") # We remove accessible_feed_present
mod3<-glmer(signs_in_yard~N_setts_in_fields
              + N_buildings
              + N_cattle_in_buildings_yard
              + accessible_feed_store_present
              + accessible_cattle_house_present
              + grass_silage
              + cereal_silage
              + hay_straw
              + cereal_grains
              + sugar_beet
              + (1|farm_code)
              ,data=dataBadger
              ,family=binomial)

drop1(mod3,test="Chi") # We remove grass_silage
mod4<-glmer(signs_in_yard~N_setts_in_fields
              + N_buildings
              + N_cattle_in_buildings_yard
              + accessible_feed_store_present
              + accessible_cattle_house_present
              + cereal_silage
              + hay_straw
              + cereal_grains
              + sugar_beet
              + (1|farm_code)
              ,data=dataBadger
              ,family=binomial)

drop1(mod4,test="Chi") # We remove cattle house
mod5<-glmer(signs_in_yard~N_setts_in_fields
              + N_buildings
              + N_cattle_in_buildings_yard
              + accessible_feed_store_present
              + cereal_silage
              + hay_straw
              + cereal_grains
              + sugar_beet
              + (1|farm_code)
              ,data=dataBadger
              ,family=binomial)

drop1(mod5,test="Chi") # We remove cereal_grains
mod6<-glmer(signs_in_yard~N_setts_in_fields
              + N_buildings
              + N_cattle_in_buildings_yard
              + accessible_feed_store_present
              + cereal_silage
              + hay_straw
              + sugar_beet
              + (1|farm_code)
              ,data=dataBadger
              ,family=binomial)

drop1(mod6,test="Chi") # We remove cereal_silage
mod7<-glmer(signs_in_yard~N_setts_in_fields
              + N_buildings
              + N_cattle_in_buildings_yard
              + accessible_feed_store_present
              + hay_straw
              + sugar_beet
              + (1|farm_code)
              ,data=dataBadger
              ,family=binomial)

drop1(mod7,test="Chi") # We remove N_cattle_in_buildings_yard
mod8<-glmer(signs_in_yard~N_setts_in_fields
              + N_buildings
              + accessible_feed_store_present
              + hay_straw
              + sugar_beet
              + (1|farm_code)
              ,data=dataBadger
              ,family=binomial)

drop1(mod8,test="Chi") # We remove accessible_feed_store_present (same AIC as hay_straw, but higher p value)
mod9<-glmer(signs_in_yard~N_setts_in_fields
              + N_buildings
              + hay_straw
              + sugar_beet
              + (1|farm_code)
              ,data=dataBadger
              ,family=binomial)

drop1(mod9,test="Chi") # We remove hay_straw
mod10<-glmer(signs_in_yard~N_setts_in_fields
              + N_buildings
              + sugar_beet
              + (1|farm_code)
              ,data=dataBadger
              ,family=binomial)

drop1(mod10,test="Chi") # We remove sugar_beet
mod11<-glmer(signs_in_yard~N_setts_in_fields
              + N_buildings
              + (1|farm_code)
              ,data=dataBadger
              ,family=binomial)

drop1(mod11,test="Chi") # We remove N_buildings
mod12<-glmer(signs_in_yard~N_setts_in_fields
              + (1|farm_code)
              ,data=dataBadger
              ,family=binomial)

drop1(mod12,test="Chi") # mod12 is the best model
```

There are convergence issues with the first few models, which may be due to their complexity. The best model only retains the number of setts as a fixed effect.

## **Model coefficients**

```{r coefficients, include = TRUE}
summary(mod12)
```

The model summary details both the fixed and the random effects. The model can be written as: $$  logit(presence\:of\:badger\:activity) = -5.07 + 0.38 \times number\:of\:setts$$ The variance associated with the random effect (which corresponds to the variance between farms) is 4.87.

## **Significance of the random effect**

The significance of the random effect is tested via a **bootstrap** method: the likelihood of the model including the random effect is compared to the likelihood of 1000 models without the random effect.

```{r boot random, echo=TRUE,fig.height=4, fig.width=4, warning=FALSE, message = FALSE}
nBoot <- 100 # number of simulations
lrStat <- rep(NA, nBoot) # initializes a vector of size 1000 to store the likelihood ratio statistic
ft.null <-glm(signs_in_yard~N_setts_in_fields,data=dataBadger,family=binomial(link=logit)) # fits the null model (without the random effect)
ft.alt <- glmer(signs_in_yard~N_setts_in_fields+(1|farm_code),data=dataBadger,family=binomial) # fits the alternate model (with the random effect)
lrObs <- 2 * logLik(ft.alt) - 2 * logLik(ft.null) # computes the observed likelihood ratio statistic 

for (iBoot in 1:nBoot) # for each simulation
{
  dataBadger$signs_in_yardSim <- unlist(simulate(ft.null)) # badger activity is simulated from the distribution corresponding to the null model
  tryCatch(
    { # in case the glmm does not converge
      bNull <-glm(signs_in_yardSim ~ N_setts_in_fields,data=dataBadger,family=binomial(link=logit)) # fits the null model to the simulated data
      bAlt <- glmer(signs_in_yardSim ~ N_setts_in_fields+(1|farm_code),data=dataBadger,family=binomial) # fits the alternate model to the simulated data
      lrStat[iBoot] <- 2 * logLik(bAlt) - 2 * logLik(bNull) # computes the likelihood ratio statistic for the resampled data
    },
    warning = function(war) { # if there is a warning or an error, the likelihood ratio statistic is NA (to ensure the loop does not stop)
      lrStat[iBoot] <- NA
    },
    error = function(err) {
      lrStat[iBoot] <- NA
    }
  )
}

mean(lrStat > lrObs, na.rm = TRUE) # Proportion of bootstrap likelihood ratio statistic superior to the observed statistic
# It corresponds to the p value

hist(lrStat,xlim = c(0,40), col='blue', main = "Histogram of the likelihood ratio statistic", xlab = "Likelihood ratio statistic") # Histogram of the 1000 values of likelihood of the simulated model
abline(v = lrObs, col="red", lwd=3, lty=2) # Vertical red line representing the likelihood of the model including the random factor
```

All simulations lead to a likelihood ratio statistic lower than the observed statistic, which suggests that the random effect is highly significant.

## **Part of the variance explained by the model**

The function `rsq` from the package `rsq` computes three pseudo $R^2$, allowing us to separate the variance explained by the fixed effect from the variance explained by the random effect.

```{r devianceGLMM, include=TRUE}
# Estimates of deviance explained (library 'rsq')
rsq(mod12)
```

The model explains about 59% of the variance of the data, with 21% due to the fixed effect (the number of setts) and 38% due to the random effect (each individual farm).

## **Residual analysis**

A GLMM does not require normality of residuals or homogeneity of variance, and the dependance in the data has already been taken into account with the random effect. However, analyzing the residuals allows us to detect an eventual trend which could indicate a problem with the modelization. Pearson residuals are used because they take into account variance heterogeneity.

```{r ResidNB, include=TRUE, fig.height=4, fig.width=5}

resid<-residuals(mod12, type="pearson")

par(mfrow=c(1,2))
# Plotting the residuals against the fitted data
plot(resid~fitted(mod12)
      , col='dodgerblue4'
      , pch=16)
abline(h = 0)

# Plotting the residuals against the number of setts
plot(resid~ dataBadger$N_setts_in_fields, 
         pch=16,
         col="dodgerblue4",
         ylab = "Residuals",
         xlab = "Number of Setts",
         main = "")
abline(h = 0)
```

In a binomial GLMM, residuals are often difficult to interpret. No defined trend can be identified here.

## **Model predictions**

We can check if the model is able to accurately predict the presence / absence of activity signs based on the number of setts.

```{r predictions, include=TRUE, fig.height=4, fig.width=4}
set.seed(9)
N    <- nrow(dataBadger) # number of observations in the dataset
Pi   <- fitted(mod12) # predicted probabilities that activity = 1
dataBadger$Ysim <- rbinom(N, size = 1, Pi) # generates a binary outcome for badger activity, drawn from a binomial distribution with Pi as a success probability

# Confusion matrix
Z <- table(dataBadger$signs_in_yard, dataBadger$Ysim) / N
rownames(Z) <- c("Observed 0", "Observed 1")
colnames(Z) <- c("Predicted 0", "Predicted 1")
Z
# Accuracy = proportion of correctly classified observations
sum(diag(Z))

# To get an average confusion matrix over mutliple predictions, we can repeat for 1000 simulations
NSim <- 1000                           
diagZ <- numeric(NSim) # we store one accuracy value per simulation
for (i in 1:NSim) { # for each simulation
  Ysim <- rbinom(N, size = 1, Pi) # a new simulated response is generated
  Z<- table(dataBadger$signs_in_yard, Ysim) / N # creates the confusion matrix for this simulation
  diagZ[i]<-sum(diag(Z)) # computes and stores the accuracy
  }
# Boxplot of the accuracy and average accuracy
boxplot(diagZ, col='dodgerblue4',ylab='#Rate of farms well-classified')
mean(diagZ)
```

Each cell of the **confusion matrix** represents a proportion of the total observations.

-   The **true negative** rate is 77%: it corresponds to farms without badger activity where no activity was predicted

-   The **false positive** rate is 6.5%: it corresponds to farms without badger activity where activity was incorrectly predicted

-   The **true positive** rate is 8.6%: it corresponds to farms with badger activity where activity was predicted

-   The **false negative** rate is 7.6%: it corresponds to farms with badger activity where no activity was predicted

For this prediction, the overall accuracy was 0.86, which means that 86% of predictions were correct. The average accuracy over 1000 simulations is 0.88.

# **DISCUSSION**

Our model shows a positive association between the number of setts on farmland and the likelihood of badger activity. However, while the number of setts explains 21% of variance, farm-level random effects explain 38%, bringing the total explained variance to 59%: while the number of setts is clearly an important predictor, a considerable portion of variation remains due to farm-specific factors.

The positive association between badger activity and the number of setts is not surprising and consistent with the literature : in a study using cameras to detect the presence of badgers in 155 south-western English and Welsh farms, @Robertson2019 found that badger activity increased with the density of setts in a 500m radius around the farm, and decreased with the distance to the nearest sett. It is however surprising that no other variable was retained, as in the same study, badger activity was also negatively impacted by the maximum cattle capacity and the presence of inhabited buildings, and positively impacted by the number of feed stores and the number of cattle sheds.

Our model does include season or year. Yet badger activity is known to vary seasonally (@Kowalczyk2003), which means that we may have missed important dynamics.

# **CONCLUSION**

Our results provide evidence that the number of setts is a predictor of badger activity on farms. However, substantial unexplained variation indicates that other farm-specific characteristics influence badger activity.

Thank you for reading. We hope this reminder on Generalized Linear Models, with this example, has been helpful. We wish you all the best.

# **REFERENCES**