<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>EDO pr√©dation</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-169b6d0432b1a799c6e7691d07d1a7fb.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="theme.scss">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/MarieEtienne/stats-reminders"> <i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./instructions.html"> 
<span class="menu-text">Instructions</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-two-examples" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Two examples</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-two-examples">    
        <li>
    <a class="dropdown-item" href="./r_chapter.html">
 <span class="dropdown-text">Basic quarto cross ref example</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./Penguins_chapter.html">
 <span class="dropdown-text">Penguins example</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-linear-model" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Linear Model</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-linear-model">    
        <li>
    <a class="dropdown-item" href="./Linear_Model_1.html">
 <span class="dropdown-text">Penguins</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./Linear_Model_2.html">
 <span class="dropdown-text">Badgers</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-factorial-analysis" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Factorial Analysis</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-factorial-analysis">    
        <li class="dropdown-header">pca.qmd</li>
        <li class="dropdown-header">cca.qmd</li>
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-differential-equation" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Differential Equation</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-differential-equation">    
        <li class="dropdown-header">EDO_ESTIMATION.qmd</li>
        <li class="dropdown-header">EDO_LOTKA_VOLTERRA.qmd</li>
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
        
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">EDO pr√©dation</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Packages</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressPackageStartupMessages</span>({</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(ggplot2)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(dplyr)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(tidyr)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>MAIN QUESTION :</strong> How can we model the evolution of the dynamics between lynxes and hares ?</p>
<p><strong>INTRODUCTION</strong> :</p>
<p>When having a dynamic system modeled by an Ordinary Differential Equation (ODE), we usually can‚Äôt find a mathematical solution. Thus, we have 2 options : a numerical approach and a qualitative one. Here, we will focus on the latter, that is to say qualitatively predict the evolution (in terms of behavior) of N(t) (the number of the population at time t), in particular asymptotically.</p>
<p>Looking at lynx and hare pelts from the Hudson‚Äôs Bay Company‚Äôs (fur-collecting) trappers‚Äô hunts over a 90-year period, we see that the number of hare and lynx pelts is correlated. If we assume that the number of pelts collected is proportional to the total population, then we arrive at the conclusion that the hare and lynx population is correlated with a phase shift of a few years for the lynx (Elton &amp; Nicholson, 1942).</p>
<p>What is the intuition behind this? Lynxes need hares to survive, and so the lynx population can only grow if the hare population grows. There‚Äôs a time lag: when the lynx population is low, the hare population begins to grow. The lynxes then begin to have food again, and will then grow again and begin to massacre a large part of the hare population, only to run out of food. Then the cycle begins again.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="EDO_LOKTA_VOLTERA_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Logistic Prey-Predator model (in a limited environment)</strong> :</p>
<p><span class="math display">\[
\begin{cases}
\frac{dN}{dt}=r_1N(1-\frac{N}{K})-b_1NP \\
\frac{dP}{dt}=-r_2P+b_2NP
\end{cases}
\]</span></p>
<p>The parameters are the following ones (they are all positive :) ) :</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Parameters</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><span class="math inline">\(r_{1}\)</span></td>
<td>growth rate of preys‚Äô population</td>
</tr>
<tr class="even">
<td><span class="math inline">\(r_{2}\)</span></td>
<td>death rate of predators‚Äô population</td>
</tr>
<tr class="odd">
<td><span class="math inline">\(b_{1}\)</span></td>
<td>predation efficiency</td>
</tr>
<tr class="even">
<td><span class="math inline">\(b_{2}\)</span></td>
<td>predation yield</td>
</tr>
<tr class="odd">
<td><span class="math inline">\({K}\)</span></td>
<td>biotic capacity</td>
</tr>
</tbody>
</table>
<p>In such conditions, we expect the populations dynamics to evolve in different ways according to parameters value and initials conditions (the size of both population). We can relatively easily assume that a big predator‚Äôs population paired with a high predation efficiency would lead prey‚Äôs population to go extinct and, shortly after, predator‚Äôs population is expected to follow the same dynamic. The question we may now ask ourselves is the following :</p>
<p>How would the system evolve according to parameters and initials conditions variation?</p>
<p>This is where qualitative analysis steps in. But first let‚Äôs do a little bit of math.</p>
<p><strong>Equilibrium points and isoclines</strong></p>
<p>Let‚Äôs start with a bit of vocabulary, in qualitative analysis we call equilibrium points all values of N for which the derivative is 0. Mathematically it‚Äôs expressed as following : <span class="math display">\[
\frac{dN}{dt}=0\;\Longleftrightarrow\;f(N^{*})=0 \\
\]</span></p>
<p><span class="math display">\[
\text{with}\;\ \frac{dN}{dt}=f(N)
\]</span></p>
<p>For equation system such as Lotka-Volterra it would be as following : <span class="math display">\[
\begin{cases} \frac{dN_{1}}{dt}=0 \\ \frac{dN_{2}}{dt}=0 \end{cases} \;\Longleftrightarrow\; \begin{cases} f_{1}(N1^{*},N2^{*})=0 \\ f_{2}(N1^{*},N2^{*})=0 \end{cases}\\
\]</span></p>
<p><span class="math display">\[
\text{with}\;\ \begin{cases} \frac{dN_{1}}{dt}=f_{1}(N1,N2) \\ \frac{dN_{2}}{dt}=f_{2}(N1,N2) \end{cases}
\]</span> Those equilibrium points carry the information about the population sizes at which the system does not change. They can be either locally asymptotically stable (LAS), unstable (repeller) and in the case the system has more than one differential equation, saddle points may appear. Around LAS points, system will go towards the equilibrium, around repeller points, system will tend to move away from equilibrium. As for saddle points, depending on the area the system will go toward or away the equilibrium</p>
<p>In contrast to equilibrium points, where all derivative must be equal to zero, isoclines correspond to lines for which an equation of the system is individually equal to zero. Mathematically it‚Äôs expressed as following :</p>
<p><span class="math display">\[
*\text{Isoclines $N_{1}$ :} \\
\frac{dN_{1}}{dt}=0 \;\Longleftrightarrow\; f_{1}(N1,N2)=0 \\
\]</span></p>
<p><span class="math display">\[
\text{Isoclines $N_{2}$ :}\\
\frac{dN_{2}}{dt}=0\;\Longleftrightarrow\; f_{2}(N1,N2)=0 \\
\]</span></p>
<p><span class="math display">\[
\text{With}\;\begin{cases} \frac{dN_{1}}{dt}=f_{1}(N1,N2) \\ \frac{dN_{2}}{dt}=f_{2}(N1,N2) \end{cases}
\]</span></p>
<p>Plotting those isoclines on a phase plane allows us to identify some areas where the system may evolve in different ways. We can then examine the behavior of each population in the previously defined area , allowing to characterize the system overall behavior.</p>
<p>All of that is analytically calculable for some systems of differential equation system (including Lotka-Volterra logistic), but lazy as we are, we will focus on numerically approximate those solutions.</p>
<p><strong>Numerical approximation of equilibrium points and phase plane</strong></p>
<p>The first step to numerical approximation of equilibrium points and drawing a phase plan is to define the function, following the syntaxe below. We also define some parameter values for our function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>Proiepred<span class="ot">&lt;-</span> <span class="cf">function</span>(t, y, parameters) {</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Here we define the initial condition from the vector</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># The order of initial condition must be the following : y=c(prey,predator)</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  N <span class="ot">&lt;-</span> y[<span class="dv">1</span>]</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  P <span class="ot">&lt;-</span> y[<span class="dv">2</span>]</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Here we define the parameter from the vector</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># The order must be the following : parameters=c(r1,r2,b1,b2,K)</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  r1 <span class="ot">&lt;-</span> parameters[<span class="dv">1</span>]</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  r2 <span class="ot">&lt;-</span> parameters[<span class="dv">2</span>]</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  b1 <span class="ot">&lt;-</span> parameters[<span class="dv">3</span>]</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  b2 <span class="ot">&lt;-</span> parameters[<span class="dv">4</span>]</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  K <span class="ot">&lt;-</span> parameters[<span class="dv">5</span>]</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># On impl√©mente nos √©quations diff√©rentielles</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  dPop <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="dv">2</span>)</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>  dPop[<span class="dv">1</span>] <span class="ot">&lt;-</span> r1<span class="sc">*</span>N<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>N<span class="sc">/</span>K) <span class="sc">-</span> b1<span class="sc">*</span>N<span class="sc">*</span>P</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>  dPop[<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="sc">-</span> r2<span class="sc">*</span>P <span class="sc">+</span> b2<span class="sc">*</span>N<span class="sc">*</span>P</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(dPop)</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="co">#On d√©finit nos param√®tres</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>parameters1 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">r1 =</span> <span class="fl">0.5</span>, <span class="at">r2 =</span> <span class="fl">0.3</span>, <span class="at">b1 =</span> <span class="fl">0.02</span>, <span class="at">b2 =</span> <span class="fl">0.01</span>,<span class="at">K=</span><span class="dv">50</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now that the function is defined, we can use the package ‚Äò<strong>phaseR</strong>‚Äô to draw a phase plan and draw the isocline using function <em>flowField</em> and <em>nullclines</em>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Loading the library</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(phaseR)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Defining the limit for the studied window by flowField</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>xlim <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">50</span>)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>ylim <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">50</span>)  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generating a phase plan for our equation </span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">flowField</span>(</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">deriv =</span> Proiepred,</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlim =</span> xlim,</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylim =</span> ylim,</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">parameters =</span> parameters1,</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">system=</span><span class="st">"two.dim"</span>,</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">add=</span><span class="cn">FALSE</span>,</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">tend=</span><span class="dv">100</span>, <span class="at">xlab=</span><span class="st">"Prey"</span>, <span class="at">ylab=</span><span class="st">"Predator"</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Generating the isoclines for our equation</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="fu">nullclines</span>(Proiepred,<span class="at">xlim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">10</span>,<span class="dv">100</span>),<span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">10</span>,<span class="dv">100</span>),<span class="at">parameters =</span> parameters1, <span class="at">points =</span> <span class="dv">500</span>,<span class="at">add.legend =</span> <span class="cn">FALSE</span>,<span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="fu">trajectory</span>(Proiepred,<span class="at">y0=</span><span class="fu">c</span>(<span class="dv">40</span>,<span class="dv">40</span>),<span class="at">tlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">100</span>),<span class="at">parameters=</span>parameters1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="EDO_LOKTA_VOLTERA_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">simul_traj</span>(<span class="at">N_0=</span> <span class="dv">40</span>,</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">P_0=</span> <span class="dv">40</span>,</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">t_end=</span> <span class="dv">50</span>,</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">pas=</span> <span class="dv">1</span>,</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">r1=</span> <span class="fl">0.5</span>,</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">b1=</span> <span class="fl">0.02</span>,</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">r2=</span> <span class="fl">0.3</span>,</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">b2=</span> <span class="fl">0.01</span>,</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">K=</span> <span class="dv">50</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="EDO_LOKTA_VOLTERA_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>From this graphic we could already interpret the isoclines and the equilibrium point. We can also use the function <em>findEquilibrium</em> to discuss those equilibrium points. We can approximate the equilibrium points from the graphic, looking at the intersect of isoclines.</p>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Approximating the equilibrium point around the isocline intersection at (0,0)</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>eq0 <span class="ot">&lt;-</span> <span class="fu">findEquilibrium</span>(Proiepred, <span class="at">y0 =</span> <span class="fu">c</span>(<span class="at">N=</span><span class="dv">0</span>, <span class="at">P=</span><span class="dv">0</span>), <span class="at">parameters =</span> parameters1)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Approximating the equilibrium point around the isocline intersection at (30,15)</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>eq1 <span class="ot">&lt;-</span> <span class="fu">findEquilibrium</span>(Proiepred, <span class="at">y0 =</span> <span class="fu">c</span>(<span class="at">N=</span><span class="dv">30</span>, <span class="at">P=</span><span class="dv">15</span>), <span class="at">parameters =</span> parameters1)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Approximating the equilibrium point around the isocline intersection at (50,0)</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>eq2 <span class="ot">&lt;-</span> <span class="fu">findEquilibrium</span>(Proiepred, <span class="at">y0 =</span> <span class="fu">c</span>(<span class="at">N=</span><span class="dv">50</span>, <span class="at">P=</span><span class="dv">0</span>), <span class="at">parameters =</span> parameters1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>$eq0_classification
[1] "Saddle"

$eq1_classification
[1] "Stable focus"

$eq2_classification
[1] "Saddle"</code></pre>
</div>
</div>
<p>We can now see that there is three equilibrium points for the Lotka-Volterra logistic function, two of them are saddle : (0,0) , (50, 0). The equilibrium points at (30,10) is a stable point, both population will tend to stabilize around the third equlibrium point as time goes on.</p>
<p>We may now question ourselves, what is the impact of initial parameters for our system?</p>
<p>Let‚Äôs repeat the process but with different parameters values :)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Defining the limit for the studied window by flowField</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>parameters2 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">r1 =</span> <span class="fl">0.5</span>, <span class="at">r2 =</span> <span class="fl">0.3</span>, <span class="at">b1 =</span> <span class="fl">0.02</span>, <span class="at">b2 =</span> <span class="fl">0.01</span>,<span class="at">K=</span><span class="dv">25</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>xlim <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">50</span>)  <span class="co"># N</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>ylim <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">50</span>)  <span class="co"># P</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="fu">flowField</span>(</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">deriv =</span> Proiepred,</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlim =</span> xlim,</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylim =</span> ylim,</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">parameters =</span> parameters2,</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">system=</span><span class="st">"two.dim"</span>,</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">add=</span><span class="cn">FALSE</span>,</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">tend=</span><span class="dv">100</span>, <span class="at">xlab=</span><span class="st">"Prey"</span>, <span class="at">ylab=</span><span class="st">"Predator"</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="fu">nullclines</span>(Proiepred,<span class="at">xlim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">10</span>,<span class="dv">100</span>),<span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">10</span>,<span class="dv">100</span>),<span class="at">parameters =</span> parameters2, <span class="at">points =</span> <span class="dv">500</span>,<span class="at">add.legend =</span> <span class="cn">FALSE</span>,<span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="fu">trajectory</span>(Proiepred,<span class="at">y0=</span><span class="fu">c</span>(<span class="dv">40</span>,<span class="dv">40</span>),<span class="at">tlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">100</span>),<span class="at">parameters=</span>parameters2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="EDO_LOKTA_VOLTERA_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">simul_traj</span>(<span class="at">N_0=</span> <span class="dv">40</span>,</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">P_0=</span> <span class="dv">40</span>,</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">t_end=</span> <span class="dv">50</span>,</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">pas=</span> <span class="dv">1</span>,</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">r1=</span> <span class="fl">0.5</span>,</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">b1=</span> <span class="fl">0.02</span>,</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">r2=</span> <span class="fl">0.3</span>,</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">b2=</span> <span class="fl">0.01</span>,</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">K=</span> <span class="dv">25</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="EDO_LOKTA_VOLTERA_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>After changing the parameter values, it now appears that there is only two equilibrium points! But what about their stability?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>eq0 <span class="ot">&lt;-</span> <span class="fu">findEquilibrium</span>(Proiepred, <span class="at">y0 =</span> <span class="fu">c</span>(<span class="at">N=</span><span class="dv">0</span>, <span class="at">P=</span><span class="dv">0</span>), <span class="at">parameters =</span> parameters2)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>eq1 <span class="ot">&lt;-</span> <span class="fu">findEquilibrium</span>(Proiepred, <span class="at">y0 =</span> <span class="fu">c</span>(<span class="at">N=</span><span class="dv">25</span>, <span class="at">P=</span><span class="dv">0</span>), <span class="at">parameters =</span> parameters2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>$eq0_classification
[1] "Saddle"

$eq1_classification
[1] "Stable node"</code></pre>
</div>
</div>
<p>The equilibrium point at (0,0) is still a saddle point, both population aren‚Äôt supposed to go extinct. But the second equilibrium point changed a lot, it is a saddle point, with predator going towards extinction.</p>
<p>What truly change here?</p>
<p>When going from the first set of parameters to the second we changed a ratio, we went from r2 &lt; K*b2 to r2&gt;K*b2. Phrased differently, we went from a situation where the natural loss in predator population was less than what is gained if the prey population is at the maximum of environmental capacity to a situation where the natural loss exceeds the gain.</p>
<p>When doing numerical approximation of a system, it is important to consider the variation induced by the parameters values. In order to do so, the best way remain the analytic approach.</p>
<p><strong><em>Bonus :</em></strong> We lied !! In the end, for those who are interested, we are going to describe the analytic approach.</p>
<p>To do so, we will introduce the <strong>Jacobian Matrix</strong> (Fun Fact : it was named after Carl Gustav Jacobi, an important 19th century mathematician who added huge contributions to the field of linear algebra).</p>
<p>This matrix is composed of the first-order partial derivatives of a multivariable function. The formula for the Jacobian Matrix is the following :</p>
<p><span class="math display">\[
\begin{equation}
Jac(N_1, N_2) =
\begin{pmatrix}
\frac{\partial f_1}{\partial N_1} &amp; \frac{\partial f_1}{\partial N_2} \\
\frac{\partial f_2}{\partial N_1} &amp; \frac{\partial f_2}{\partial N_2}
\end{pmatrix}
\end{equation}
\]</span></p>
<p>In contrast with the previous part where we had 2 equations, here we have 4 terms in the matrix, in particular 4 partial derivatives. After finding the fixed points, by resolving the equations detailed in the first part, now we can easily replace the values of <span class="math inline">\(N1^{*}\)</span> and <span class="math inline">\(N2^{*}\)</span> in the Jacobian Matrix and then study the stability of the fixed points.</p>
<p>In the analytic approach, the stability of a fixed point (<span class="math inline">\(N1^{*}\)</span>, <span class="math inline">\(N2^{*}\)</span>) is related to the signs of the real parts of the <strong>eigenvalues</strong> ‚Äã‚Äãof <span class="math inline">\(Jac(N1^{*},N2^{*})\)</span>:</p>
<ul>
<li><p>(<span class="math inline">\(N1^{*}\)</span>, <span class="math inline">\(N2^{*}\)</span>) is locally <strong>asymptotically stable (LAS)</strong> if all its eigenvalues are (with real parts) &lt;0</p></li>
<li><p>(<span class="math inline">\(N1^{*}\)</span>, <span class="math inline">\(N2^{*}\)</span>) is <strong>unstable</strong> otherwise, including:</p>
<p><strong>repulsor</strong> if all eigenvalues ‚Äã‚Äãare (with real parts) &gt;0</p>
<p><strong>saddle point</strong> if some eigenvalues are (with real parts) &lt;0 and the others (with real parts) &gt;0.</p></li>
</ul>
<p>Because the matrix <span class="math inline">\(Jac(N1^{*},N2^{*})\)</span> is of dimension 2, it has exactly two eigenvalues and we can calculate the Trace (sum of the eigenvalues ) and the Determinant (product of the eigenvalues) of the Jacobian Matrix which will help us to determine the stability of the fixed points. If a Jacobian Matrix is defined as followed :</p>
<p><span class="math display">\[
\begin{equation}
Jac(N_1^*, N_2^*) =
\begin{pmatrix}
a &amp; b \\
c &amp; d
\end{pmatrix}
\end{equation}
\]</span></p>
<p>The Trace and the Determinant correspond to : ùëáùëüùëéùëêùëí = ùëé + ùëë and ùê∑ùëíùë° = ùëéùëë ‚àí ùëèùëê.</p>
<p>In particular,</p>
<ul>
<li>(<span class="math inline">\(N1^{*}\)</span>, <span class="math inline">\(N2^{*}\)</span>) is locally <strong>asymptotically stable (LAS)</strong> if Trace &lt;0 and Det &gt;0.</li>
<li>(<span class="math inline">\(N1^{*}\)</span>, <span class="math inline">\(N2^{*}\)</span>) is <strong>repulsor</strong> if Trace &gt; 0 and Det &gt;0.</li>
<li>(<span class="math inline">\(N1^{*}\)</span>, <span class="math inline">\(N2^{*}\)</span>) is <strong>saddle point</strong> if Det &lt; 0 (whatever the Trace).</li>
</ul>
<p>Let‚Äôs apply the analytic approach to the logistic Prey-Predator Model, shall we ?</p>
<p>Our system admits 3 fixed points : (<span class="math inline">\({0}\)</span>,<span class="math inline">\({0}\)</span>), (<span class="math inline">\({K}\)</span>,<span class="math inline">\({0}\)</span>) and (<span class="math inline">\(N^{*}\)</span>, <span class="math inline">\(P^{*}\)</span>) where : <span class="math display">\[
(N^*, P^*) =
\left(
\frac{r_2}{b_2},\;
\frac{r_1}{b_1} \left( 1 - \frac{r_2}{b_2 K} \right)
\right)
\]</span></p>
<p>After calculating the partial derivatives in the Jacobian Matrix :</p>
<p><span class="math display">\[
\begin{equation}
Jac(N,P) =
\begin{pmatrix}
(r_1(1 - \frac{N}{K})-b_1P)-r_1\frac{N}{K}  &amp; -b_1N \\
b_2P &amp; -r_2 + b_2N
\end{pmatrix}
\end{equation}
\]</span></p>
<p>Now we can obtain a Jacobian Matrix for each fixed point :</p>
<p><span class="math display">\[
\begin{equation}
Jac(0,0) =
\begin{pmatrix}
r_1 &amp; 0 \\
0 &amp; -r_2
\end{pmatrix}
\end{equation}
\]</span></p>
<p>For the first one, we can easily determine the eigenvalues because it is a diagonal matrix, so the eigenvalues are on the diagonal. <span class="math inline">\({r_1}\)</span> &gt; 0 and <span class="math inline">\({-r_2}\)</span> &lt;0, so (<span class="math inline">\({0}\)</span>,<span class="math inline">\({0}\)</span>) is a saddle point.</p>
<p><span class="math display">\[
\begin{equation}
Jac(K,0) =
\begin{pmatrix}
-r_1 &amp; -b_1K \\
0 &amp; -r_2 + b_2K
\end{pmatrix}
\end{equation}
\]</span></p>
<p>Here, we have a triangular matrix, so the eigenvalues are also on the diagonal. <span class="math inline">\({-r_1}\)</span> &lt; 0 and <span class="math inline">\({-r_2 + b_2K}\)</span> &lt; 0 if <span class="math inline">\({r_2}\)</span> &gt; <span class="math inline">\({b_2K}\)</span> which makes (<span class="math inline">\({K}\)</span>,<span class="math inline">\({0}\)</span>) a LAS and a saddle point otherwise.</p>
<p>For the last fixed point (<span class="math inline">\(N^{*}\)</span>, <span class="math inline">\(P^{*}\)</span>), <span class="math inline">\(r_1(1 - \frac{N^{*}}{K})-b_1P^{*}\)</span> = 0 (see the definition of the isocline <span class="math inline">\(N\)</span> : <span class="math inline">\(\frac{dN}{dt} = 0\)</span> ) because <span class="math inline">\({N^{*}}\)</span> is different from 0.</p>
<p>Thus, the last Jacobian matrix is written as :</p>
<p><span class="math display">\[
\begin{equation}
Jac(N^{*},P^{*}) =
\begin{pmatrix}
-r_1\frac{N^{*}}{K} &amp; -b_1N^{*} \\
b_2P &amp; 0
\end{pmatrix}
\end{equation}
\]</span></p>
<p>Finally, when calculating the trace and the determinant (see the definitions above), we find a negative trace and a positive determinant for <span class="math inline">\(N^{*}\)</span> and <span class="math inline">\(P^{*}\)</span> positive. So, (<span class="math inline">\(N^{*}\)</span>, <span class="math inline">\(P^{*}\)</span>) is a LAS when it interests us.</p>
<p><strong>CONCLUSION :</strong></p>
<p>Through this work, we presented a way to qualitatively analyse the dynamics of a Logistic Prey-Predator Model. Depending on the values of the parameters of the ODE, the nature of the fixed points changes and so the trajectories of the size of the populations do. We identified 3 main situations : the total extinction of both populations (unstable because the lower presence of prey allows the population to grow), survival of prey only at their capacity limit K (stable or unstable depending on the capacity of the predators to persist thanks to the potential gains) and the stable coexistence of the 2 species that only exists if predators can maintain themselves. To summarize, the dynamics of the model illustrate both the mutual dependence and ecological regulation between prey and predator.</p>
<p>As a doorway, we could also be interested in qualitatively predicting the solution of a system of more than 2 equations that could model more complex phenomenon (like epidemiological models SIR or SEIR). The definitions of LAS and unstable (repulsor and saddle points) would remain valid but the calculations would be more complicated. Also, we would look at the Routh-Hurwitz criteria in addition of the trace and the determinant and the representation of isoclines and field portraits would be less obvious.</p>



</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "Óßã";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>